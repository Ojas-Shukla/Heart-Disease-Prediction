# -*- coding: utf-8 -*-
"""App.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/12ZBe-y0oGkn0kWymozNAYGVermQznDzW
"""


import streamlit as st
import pandas as pd
import numpy as np
import joblib
import os

model_path ='/content/heart_disease_model.joblib'

model = joblib.load(model_path)

st.set_page_config(page_title='Heart Disease Prediction', layout='centered')

st.title('Heart Disease Prediction')
st.write('Enter the patient information to predict heart disease.')

def user_input_features():
  age = st.sidebar.number_input('Age', min_value=18, max_value = 100)
  sex = st.sidebar.selectbox('Sex', options = ['Male', 'Female'])
  sex_value = 1 if sex == 'Male' else 0
  cp = st.sidebar.selectbox('Chest Pain Type', options = [0,1,2,3])
  trestbps = st.sidebar.number_input('trestbps', min_value = 80, max_value = 200)
  chol = st.sidebar.slider('cholestrol', 100, 600, 240)
  fbs = st.sidebar.selectbox('FBS', options = [0,1])
  restecg = st.sidebar.selectbox('Resting ECG', options = [0,1,2])
  thalach = st.sidebar.slider('Maximum Heart Rate', 60, 220, 150)
  exang_selection = st.sidebar.selectbox('exang', options = [('No',0),('yes',1)])
  exang = exang_selection[1] # Extract the integer value from the tuple
  oldpeak = st.sidebar.slider('oldpeak', 0.0, 6.0, 1.0)
  slope = st.sidebar.selectbox('slope', options = [0,1,2])
  ca = st.sidebar.selectbox('ca', options = [0,1,2,3])
  thal = st.sidebar.selectbox('thal', options = [0,1,2,3])

  data = {
    'age': age,
    'sex': sex,
    'cp': cp,
    'trestbps': trestbps,
    'chol': chol,
    'fbs': fbs,
    'restecg': restecg,
    'thalach': thalach,
    'exang': exang,
    'oldpeak': oldpeak,
    'slope' : slope,
    'ca': ca,
    'thal': thal
}
  features = pd.DataFrame([data])
  return features

input_df = user_input_features()
st.subheader('Entered patient data')
st.dataframe(input_df)

st.markdown('****')

if st.button('Predict heart disease'):
  try:
    prediction = model.predict(input_df)
    st.subheader('Prediction result')
    if prediction[0] == 0:
      st.write('The patient does not have heart disease.')
    else:
      st.write('The patient has heart disease.')
      st.write('Please consult a doctor.')
      st.markdown('****')
      st.subheader('Prediction probabilities')
      prediction_proba = model.predict_proba(input_df)
      prob = prediction_proba[0][1] # Probability of having heart disease
      st.write(f'Estimated probability of heart disease: {prob * 100:.2f}%')
      if prob < 0.5:
        st.write('The model is not confident in its prediction.')
      else :
        st.write('The model is confident in its prediction.')
  except Exception as e:
    st.error(f'An error occurred during prediction: {e}')
